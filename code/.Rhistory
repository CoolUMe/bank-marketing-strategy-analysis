select <- dplyr::select
mutate <- dplyr::mutate
summarise <- dplyr::summarise
summarize <- dplyr::summarize
# 导入数据
bank <- read_delim("../data/origin/bank-additional/bank-additional-full.csv", #使用相对路径，请使用将工作路径设置到“code”文件夹，下同
";", escape_double = FALSE, trim_ws = TRUE)
# 画图主题
text_theme = theme(
plot.title = element_text(face="bold", hjust = 0.5,size = 16),
plot.subtitle = element_text(face="bold", hjust = 0.5,size = 4,margin = c(t = 13, r = 0, b = 17, l = 0)),
axis.title=element_text(size=14),
legend.title=element_text(size=14))
colors <- c("#E69F00", "#56B4E9", "#009E73","#d9a99e",
"#F0E442", "#0072B2", "#D55E00", "#CC79A7",
"#F4EDCA",  "#9a3820",  "#a7a97c")
# 导入包 (直接运行即可安装)
## 数据处理
if(!require("magrittr")) install.packages("magrittr")
if(!require("readr")) install.packages("readr")
if(!require("dplyr")) install.packages("dplyr")
if(!require("tidyr")) install.packages("tidyr")
if(!require("tidyverse")) install.packages("tidyverse")
if(!require("openxlsx")) install.packages("openxlsx")
## 可视化
if(!require("purrr")) install.packages("purrr")
if(!require("stringr")) install.packages("stringr")
if(!require("ggplot2")) install.packages("ggplot2")
if(!require("cowplot")) install.packages("cowplot")
if(!require("caret")) install.packages("caret")
if(!require("cowplot")) install.packages("cowplot")
if(!require("corrplot")) install.packages("corrplot")
if(!require("DALEX")) install.packages("DALEX")
if(!require("DescTools")) install.packages("DescTools")
if(!require("doParallel")) install.packages("doParallel")
if(!require("GGally")) install.packages("GGally")
if(!require("Rmisc")) install.packages("Rmisc")
if(!require("PupillometryR")) install.packages("PupillometryR")
if(!require("inspectdf")) install.packages("inspectdf")
if(!require("vcd")) install.packages("vcd")
if(!require("ggpubr")) install.packages("ggpubr")
if(!require("ggmosaic")) install.packages("ggmosaic")
if(!require("scales")) install.packages("scales")
if(!require("ggridges")) install.packages("ggridges")
if(!require("viridis")) install.packages("viridis")
## 缺失值处理
if(!require("lattice")) install.packages("lattice")
if(!require("MASS")) install.packages("MASS")
if(!require("nnet")) install.packages("nnet")
if(!require("mice")) install.packages("mice")
if(!require("missForest")) install.packages("missForest")
# 防止包的冲突
select <- dplyr::select
mutate <- dplyr::mutate
summarise <- dplyr::summarise
summarize <- dplyr::summarize
# 导入数据
bank <- read_delim("../data/origin/bank-additional/bank-additional-full.csv", #使用相对路径，请使用将工作路径设置到“code”文件夹，下同
";", escape_double = FALSE, trim_ws = TRUE)
# 画图主题
text_theme = theme(
plot.title = element_text(face="bold", hjust = 0.5,size = 16),
plot.subtitle = element_text(face="bold", hjust = 0.5,size = 4,margin = c(t = 13, r = 0, b = 17, l = 0)),
axis.title=element_text(size=14),
legend.title=element_text(size=14))
colors <- c("#E69F00", "#56B4E9", "#009E73","#d9a99e",
"#F0E442", "#0072B2", "#D55E00", "#CC79A7",
"#F4EDCA",  "#9a3820",  "#a7a97c")
# 导入包 (直接运行即可安装)
## 数据处理
if(!require("magrittr")) install.packages("magrittr")
if(!require("readr")) install.packages("readr")
if(!require("dplyr")) install.packages("dplyr")
if(!require("tidyr")) install.packages("tidyr")
if(!require("tidyverse")) install.packages("tidyverse")
if(!require("openxlsx")) install.packages("openxlsx")
## 可视化
if(!require("purrr")) install.packages("purrr")
if(!require("stringr")) install.packages("stringr")
if(!require("ggplot2")) install.packages("ggplot2")
if(!require("cowplot")) install.packages("cowplot")
if(!require("caret")) install.packages("caret")
if(!require("cowplot")) install.packages("cowplot")
if(!require("corrplot")) install.packages("corrplot")
if(!require("DALEX")) install.packages("DALEX")
if(!require("DescTools")) install.packages("DescTools")
if(!require("doParallel")) install.packages("doParallel")
if(!require("GGally")) install.packages("GGally")
if(!require("Rmisc")) install.packages("Rmisc")
if(!require("PupillometryR")) install.packages("PupillometryR")
if(!require("inspectdf")) install.packages("inspectdf")
if(!require("vcd")) install.packages("vcd")
if(!require("ggpubr")) install.packages("ggpubr")
if(!require("ggmosaic")) install.packages("ggmosaic")
if(!require("scales")) install.packages("scales")
if(!require("ggridges")) install.packages("ggridges")
if(!require("viridis")) install.packages("viridis")
## 缺失值处理
if(!require("lattice")) install.packages("lattice")
if(!require("MASS")) install.packages("MASS")
if(!require("nnet")) install.packages("nnet")
if(!require("mice")) install.packages("mice")
if(!require("missForest")) install.packages("missForest")
# 防止包的冲突
select <- dplyr::select
mutate <- dplyr::mutate
summarise <- dplyr::summarise
summarize <- dplyr::summarize
# 导入数据
bank <- read_delim("../data/origin/bank-additional/bank-additional-full.csv", #使用相对路径，请使用将工作路径设置到“code”文件夹，下同
";", escape_double = FALSE, trim_ws = TRUE)
# 画图主题
text_theme = theme(
plot.title = element_text(face="bold", hjust = 0.5,size = 16),
plot.subtitle = element_text(face="bold", hjust = 0.5,size = 4,margin = c(t = 13, r = 0, b = 17, l = 0)),
axis.title=element_text(size=14),
legend.title=element_text(size=14))
colors <- c("#E69F00", "#56B4E9", "#009E73","#d9a99e",
"#F0E442", "#0072B2", "#D55E00", "#CC79A7",
"#F4EDCA",  "#9a3820",  "#a7a97c")
# 导入包 (直接运行即可安装)
## 数据处理
if(!require("magrittr")) install.packages("magrittr")
if(!require("readr")) install.packages("readr")
if(!require("dplyr")) install.packages("dplyr")
if(!require("tidyr")) install.packages("tidyr")
if(!require("tidyverse")) install.packages("tidyverse")
if(!require("openxlsx")) install.packages("openxlsx")
## 可视化
if(!require("purrr")) install.packages("purrr")
if(!require("stringr")) install.packages("stringr")
if(!require("ggplot2")) install.packages("ggplot2")
if(!require("cowplot")) install.packages("cowplot")
if(!require("caret")) install.packages("caret")
if(!require("cowplot")) install.packages("cowplot")
if(!require("corrplot")) install.packages("corrplot")
if(!require("DALEX")) install.packages("DALEX")
if(!require("DescTools")) install.packages("DescTools")
if(!require("doParallel")) install.packages("doParallel")
if(!require("GGally")) install.packages("GGally")
if(!require("Rmisc")) install.packages("Rmisc")
if(!require("PupillometryR")) install.packages("PupillometryR")
if(!require("inspectdf")) install.packages("inspectdf")
if(!require("vcd")) install.packages("vcd")
if(!require("ggpubr")) install.packages("ggpubr")
if(!require("ggmosaic")) install.packages("ggmosaic")
if(!require("scales")) install.packages("scales")
if(!require("ggridges")) install.packages("ggridges")
if(!require("viridis")) install.packages("viridis")
## 缺失值处理
if(!require("lattice")) install.packages("lattice")
if(!require("MASS")) install.packages("MASS")
if(!require("nnet")) install.packages("nnet")
if(!require("mice")) install.packages("mice")
if(!require("missForest")) install.packages("missForest")
# 防止包的冲突
select <- dplyr::select
mutate <- dplyr::mutate
summarise <- dplyr::summarise
summarize <- dplyr::summarize
# 导入数据
bank <- read_delim("../data/origin/bank-additional/bank-additional-full.csv", #使用相对路径，请使用将工作路径设置到“code”文件夹，下同
";", escape_double = FALSE, trim_ws = TRUE)
# 画图主题
text_theme = theme(
plot.title = element_text(face="bold", hjust = 0.5,size = 16),
plot.subtitle = element_text(face="bold", hjust = 0.5,size = 4,margin = c(t = 13, r = 0, b = 17, l = 0)),
axis.title=element_text(size=14),
legend.title=element_text(size=14))
colors <- c("#E69F00", "#56B4E9", "#009E73","#d9a99e",
"#F0E442", "#0072B2", "#D55E00", "#CC79A7",
"#F4EDCA",  "#9a3820",  "#a7a97c")
# 导入包 (直接运行即可安装)
## 数据处理
if(!require("magrittr")) install.packages("magrittr")
if(!require("readr")) install.packages("readr")
if(!require("dplyr")) install.packages("dplyr")
if(!require("tidyr")) install.packages("tidyr")
if(!require("tidyverse")) install.packages("tidyverse")
if(!require("openxlsx")) install.packages("openxlsx")
## 可视化
if(!require("purrr")) install.packages("purrr")
if(!require("stringr")) install.packages("stringr")
if(!require("ggplot2")) install.packages("ggplot2")
if(!require("cowplot")) install.packages("cowplot")
if(!require("caret")) install.packages("caret")
if(!require("cowplot")) install.packages("cowplot")
if(!require("corrplot")) install.packages("corrplot")
if(!require("DALEX")) install.packages("DALEX")
if(!require("DescTools")) install.packages("DescTools")
if(!require("doParallel")) install.packages("doParallel")
if(!require("GGally")) install.packages("GGally")
if(!require("Rmisc")) install.packages("Rmisc")
if(!require("PupillometryR")) install.packages("PupillometryR")
if(!require("inspectdf")) install.packages("inspectdf")
if(!require("vcd")) install.packages("vcd")
if(!require("ggpubr")) install.packages("ggpubr")
if(!require("ggmosaic")) install.packages("ggmosaic")
if(!require("scales")) install.packages("scales")
if(!require("ggridges")) install.packages("ggridges")
if(!require("viridis")) install.packages("viridis")
## 缺失值处理
if(!require("lattice")) install.packages("lattice")
if(!require("MASS")) install.packages("MASS")
if(!require("nnet")) install.packages("nnet")
if(!require("mice")) install.packages("mice")
if(!require("missForest")) install.packages("missForest")
# 防止包的冲突
select <- dplyr::select
mutate <- dplyr::mutate
summarise <- dplyr::summarise
summarize <- dplyr::summarize
# 导入数据
bank <- read_delim("../data/origin/bank-additional/bank-additional-full.csv", #使用相对路径，请使用将工作路径设置到“code”文件夹，下同
";", escape_double = FALSE, trim_ws = TRUE)
# 画图主题
text_theme = theme(
plot.title = element_text(face="bold", hjust = 0.5,size = 16),
plot.subtitle = element_text(face="bold", hjust = 0.5,size = 4,margin = c(t = 13, r = 0, b = 17, l = 0)),
axis.title=element_text(size=14),
legend.title=element_text(size=14))
colors <- c("#E69F00", "#56B4E9", "#009E73","#d9a99e",
"#F0E442", "#0072B2", "#D55E00", "#CC79A7",
"#F4EDCA",  "#9a3820",  "#a7a97c")
# 导入包 (直接运行即可安装)
## 数据处理
if(!require("magrittr")) install.packages("magrittr")
if(!require("readr")) install.packages("readr")
if(!require("dplyr")) install.packages("dplyr")
if(!require("tidyr")) install.packages("tidyr")
if(!require("tidyverse")) install.packages("tidyverse")
if(!require("openxlsx")) install.packages("openxlsx")
## 可视化
if(!require("purrr")) install.packages("purrr")
if(!require("stringr")) install.packages("stringr")
if(!require("ggplot2")) install.packages("ggplot2")
if(!require("cowplot")) install.packages("cowplot")
if(!require("caret")) install.packages("caret")
if(!require("cowplot")) install.packages("cowplot")
if(!require("corrplot")) install.packages("corrplot")
if(!require("DALEX")) install.packages("DALEX")
if(!require("DescTools")) install.packages("DescTools")
if(!require("doParallel")) install.packages("doParallel")
if(!require("GGally")) install.packages("GGally")
if(!require("Rmisc")) install.packages("Rmisc")
if(!require("PupillometryR")) install.packages("PupillometryR")
if(!require("inspectdf")) install.packages("inspectdf")
if(!require("vcd")) install.packages("vcd")
if(!require("ggpubr")) install.packages("ggpubr")
if(!require("ggmosaic")) install.packages("ggmosaic")
if(!require("scales")) install.packages("scales")
if(!require("ggridges")) install.packages("ggridges")
if(!require("viridis")) install.packages("viridis")
## 缺失值处理
if(!require("lattice")) install.packages("lattice")
if(!require("MASS")) install.packages("MASS")
if(!require("nnet")) install.packages("nnet")
if(!require("mice")) install.packages("mice")
if(!require("missForest")) install.packages("missForest")
# 防止包的冲突
select <- dplyr::select
mutate <- dplyr::mutate
summarise <- dplyr::summarise
summarize <- dplyr::summarize
# 导入数据
bank <- read_delim("../data/origin/bank-additional/bank-additional-full.csv", #使用相对路径，请使用将工作路径设置到“code”文件夹，下同
";", escape_double = FALSE, trim_ws = TRUE)
# 画图主题
text_theme = theme(
plot.title = element_text(face="bold", hjust = 0.5,size = 16),
plot.subtitle = element_text(face="bold", hjust = 0.5,size = 4,margin = c(t = 13, r = 0, b = 17, l = 0)),
axis.title=element_text(size=14),
legend.title=element_text(size=14))
colors <- c("#E69F00", "#56B4E9", "#009E73","#d9a99e",
"#F0E442", "#0072B2", "#D55E00", "#CC79A7",
"#F4EDCA",  "#9a3820",  "#a7a97c")
setwd("~/学习资料/数据挖掘/学校课程/定性期中/bank-marketing-strategy-analysis/code")
get_range <- function(var, data=bank){
target = data %>% distinct(!!sym(var)) %>% pull(1)
if(is.numeric(target) | is.integer(target)){
str1 = paste(range(target), collapse=", ")
return(paste0("[",str1,"]"))}
else{
str1 = paste(target,collapse = "、")
str2 = paste0("等",length(target),"类取值")
return(paste0(str1,str2))} }
get_type <- function(var, data=bank){
target = data %>% distinct(!!sym(var)) %>% pull(1)
if(is.numeric(target) | is.integer(target)){
return("连续")}
else{
return("离散")} }
my_glimpse = function(data = bank, file=F){
temp = tibble("变量符号" = data %>% colnames)
if(file==F){
temp %<>%
rowwise() %>%
transmute(变量符号,
类型 = get_type(变量符号),
取值范围 = get_range(变量符号))
return(temp)
}else{
temp = tibble("变量符号" = data %>% colnames)
temp %<>%
rowwise() %>%
transmute(变量分类=NA,
变量名称 = NA,
变量符号,
类型 = get_type(变量符号),
变量含义=NA,
取值范围 = get_range(变量符号))
write.xlsx(temp,file)
return(temp)
}
}
my_glimpse(file = "../tables/part2/data_report.xlsx")
# Install and library the packages
## For data processing
if(!require("magrittr")) install.packages("magrittr")
if(!require("readr")) install.packages("readr")
if(!require("dplyr")) install.packages("dplyr")
if(!require("tidyr")) install.packages("tidyr")
if(!require("tidyverse")) install.packages("tidyverse")
if(!require("openxlsx")) install.packages("openxlsx")
## For visulization
if(!require("purrr")) install.packages("purrr")
if(!require("stringr")) install.packages("stringr")
if(!require("ggplot2")) install.packages("ggplot2")
if(!require("cowplot")) install.packages("cowplot")
if(!require("caret")) install.packages("caret")
if(!require("cowplot")) install.packages("cowplot")
if(!require("corrplot")) install.packages("corrplot")
if(!require("DALEX")) install.packages("DALEX")
if(!require("DescTools")) install.packages("DescTools")
if(!require("doParallel")) install.packages("doParallel")
if(!require("GGally")) install.packages("GGally")
if(!require("Rmisc")) install.packages("Rmisc")
if(!require("PupillometryR")) install.packages("PupillometryR")
if(!require("inspectdf")) install.packages("inspectdf")
if(!require("vcd")) install.packages("vcd")
if(!require("ggpubr")) install.packages("ggpubr")
if(!require("ggmosaic")) install.packages("ggmosaic")
if(!require("scales")) install.packages("scales")
if(!require("ggridges")) install.packages("ggridges")
if(!require("viridis")) install.packages("viridis")
## For missing value handle
if(!require("lattice")) install.packages("lattice")
if(!require("MASS")) install.packages("MASS")
if(!require("nnet")) install.packages("nnet")
if(!require("mice")) install.packages("mice")
if(!require("missForest")) install.packages("missForest")
# Avoid package conflict
select <- dplyr::select
mutate <- dplyr::mutate
summarise <- dplyr::summarise
summarize <- dplyr::summarize
# Data Input
## Please run setwd("~/yourdir/bank-marketing-strategy-analysis/code") (change yourdir to yours).
## Then, all the file dictionary work.
bank <- read_delim("../data/origin/bank-additional/bank-additional-full.csv", ";",
escape_double = FALSE, trim_ws = TRUE)
# Plotting theme
text_theme = theme(
plot.title = element_text(face="bold",
hjust = 0.5,
size = 16),
plot.subtitle = element_text(face="bold",
hjust = 0.5,
size = 4,
margin = c(t = 13, r = 0, b = 17, l = 0)),
axis.title = element_text(size=14),
legend.title = element_text(size=14))
colors <- c("#E69F00", "#56B4E9", "#009E73","#d9a99e",
"#F0E442", "#0072B2", "#D55E00", "#CC79A7",
"#F4EDCA",  "#9a3820",  "#a7a97c")
get_range <- function(var, data=bank){
target = data %>% distinct(!!sym(var)) %>% pull(1)
if(is.numeric(target) | is.integer(target)){
str1 = paste(range(target), collapse=", ")
return(paste0("[",str1,"]"))}
else{
str1 = paste(target,collapse = "、")
str2 = paste0("等",length(target),"类取值")
return(paste0(str1,str2))} }
get_type <- function(var, data=bank){
target = data %>% distinct(!!sym(var)) %>% pull(1)
if(is.numeric(target) | is.integer(target)){
return("连续")}
else{
return("离散")} }
my_glimpse = function(data = bank, file=F){
temp = tibble("变量符号" = data %>% colnames)
if(file==F){
temp %<>%
rowwise() %>%
transmute(变量符号,
类型 = get_type(变量符号),
取值范围 = get_range(变量符号))
return(temp)
}else{
temp = tibble("变量符号" = data %>% colnames)
temp %<>%
rowwise() %>%
transmute(变量分类=NA,
变量名称 = NA,
变量符号,
类型 = get_type(变量符号),
变量含义=NA,
取值范围 = get_range(变量符号))
write.xlsx(temp,file)
return(temp)
}
}
my_glimpse(file = "../tables/part2/data_report.xlsx")
if(if_plot){
inspect_cat(bank, show_plot = TRUE)
}
# 单独图
if(if_plot){
bank %>% keep(is.numeric) %>% colnames -> temp
bank %>%
select(c(y,temp)) %>%
pivot_longer(temp,'key',values_to = 'value') %>%
ggplot(aes(value)) +
facet_wrap(~ key, scales = "free", ncol=5,nrow=2) +
geom_histogram(aes(fill=y)) +
theme(axis.text.x = element_text(angle = -45, vjust = 0.5),legend.position = "bottom") +
scale_fill_manual("Result", values =colors,na.value = "#5f5f5f") +
labs(x=NULL,y=NULL) #+ theme_pubr()
# 两两散点图
my_cor = function(data, mapping, alignPercent = 0.6, method = "pearson",
use = "complete.obs", corAlignPercent = NULL, corMethod = NULL,
corUse = NULL, ...) {
return(GGally::ggally_cor(data, mapping)+theme(panel.grid.minor = element_blank(),
panel.grid.major = element_blank()))
}
smooth <- function(data, mapping, method = "loess",formula = 'y ~ x', ...) {
p <- ggplot(data = data, mapping = mapping) +
geom_point(...,alpha=0.14) +
geom_smooth(...,method = method,formula = formula,size = 1,...)
p
}
smooth_lm <- function(data, mapping, method = "lm",formula = 'y ~ x', ...) {
p <- ggplot(data = data, mapping = mapping) +
geom_point(...,alpha=0.14) +
geom_smooth(...,method = method,formula = formula,size = 1,...)
p
}
bank %>% select(where(is.numeric)) %>% colnames -> numeric_vars
bank %>% select(c("y", numeric_vars)) %>%
ggpairs(aes(color=y),
upper = list(continuous = smooth_lm,
combo = "dot",
discrete = "box",
na = "na"),
lower = list(continuous = my_cor,
combo = "box_no_facet",
discrete = "facetbar",
na = "na"),switch="y",cardinality_threshold = 16) ->p
# if_plot{
#   p
# } #图标信息量过大，不展示
}
if_plot = F # Switch upon plotting+data processing or only data processing.
if(if_plot){
inspect_cat(bank, show_plot = TRUE)}
# 单独图
if(if_plot){
bank %>% keep(is.numeric) %>% colnames -> temp
bank %>%
select(c(y,temp)) %>%
pivot_longer(temp,'key',values_to = 'value') %>%
ggplot(aes(value)) +
facet_wrap(~ key, scales = "free", ncol=5,nrow=2) +
geom_histogram(aes(fill=y)) +
theme(axis.text.x = element_text(angle = -45, vjust = 0.5),legend.position = "bottom") +
scale_fill_manual("Result", values =colors,na.value = "#5f5f5f") +
labs(x=NULL,y=NULL) #+ theme_pubr()
# 两两散点图
my_cor = function(data, mapping, alignPercent = 0.6, method = "pearson",
use = "complete.obs", corAlignPercent = NULL, corMethod = NULL,
corUse = NULL, ...) {
return(GGally::ggally_cor(data, mapping)+theme(panel.grid.minor = element_blank(),
panel.grid.major = element_blank()))
}
smooth <- function(data, mapping, method = "loess",formula = 'y ~ x', ...) {
p <- ggplot(data = data, mapping = mapping) +
geom_point(...,alpha=0.14) +
geom_smooth(...,method = method,formula = formula,size = 1,...)
p
}
smooth_lm <- function(data, mapping, method = "lm",formula = 'y ~ x', ...) {
p <- ggplot(data = data, mapping = mapping) +
geom_point(...,alpha=0.14) +
geom_smooth(...,method = method,formula = formula,size = 1,...)
p
}
bank %>% select(where(is.numeric)) %>% colnames -> numeric_vars
bank %>% select(c("y", numeric_vars)) %>%
ggpairs(aes(color=y),
upper = list(continuous = smooth_lm,
combo = "dot",
discrete = "box",
na = "na"),
lower = list(continuous = my_cor,
combo = "box_no_facet",
discrete = "facetbar",
na = "na"),switch="y",cardinality_threshold = 16) ->p
# if_plot{
#   p
# } #图标信息量过大，不展示
}
